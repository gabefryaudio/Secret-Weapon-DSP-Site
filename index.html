<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Disable phone number detection on iOS -->
  <meta name="format-detection" content="telephone=no" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secret Weapon DSP - UPPERCOMP</title>
  
  <!-- Content Security Policy:
       This CSP allows:
         - Default sources from 'self', data: and https:.
         - Scripts from 'self', inline scripts ('unsafe-inline'), eval ('unsafe-eval'),
           https: sources, and data URLs.
         - Styles from 'self', inline styles ('unsafe-inline'), and https:.
         - Images and fonts from 'self', data:, and https:.
         - Worker scripts from 'self'.
       WARNING: Allowing 'unsafe-inline' and 'unsafe-eval' reduces security.
  -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' data: https:;
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https: data:;
    style-src 'self' 'unsafe-inline' https:;
    img-src 'self' data: https:;
    font-src 'self' https:;
    worker-src 'self';
    connect-src 'self';
    object-src 'none';
  ">

  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Audiowide&family=Inter:wght@400;500;600&display=swap"
    rel="stylesheet"
  />

  <!-- Font Awesome (CDN) -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <style>
    :root {
      --main-bg-color: #1a1a1a;
      --accent-color: #2E7D32;
      --text-color: #ccc;
      --secondary-bg: #1e1e1e;
      --header-font: 'Audiowide', sans-serif;
      --body-font: 'Inter', sans-serif;
    }

    /* Remove iOS tap highlight, unify link states */
    a, button {
      -webkit-tap-highlight-color: transparent;
    }
    /* Force visited links to stay the same color as normal links */
    .nav-links a:link,
    .nav-links a:visited {
      color: var(--text-color);
      text-decoration: none;
    }
    .nav-links a:hover,
    .nav-links a:focus,
    .nav-links a:active {
      color: var(--accent-color);
      outline: none;
      text-decoration: none;
    }

    /* Force vertical scroll */
    /* Allow horizontal and vertical scroll as needed */
    html, body {
      overflow-x: auto;
      overflow-y: auto;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: var(--body-font);
      background-color: var(--main-bg-color);
      color: var(--text-color);
      line-height: 1.6;
      overflow-y: auto !important;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      width: 100%;
      box-sizing: border-box;
    }

    /* Header */
    header {
      padding: 20px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      position: relative;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo {
      width: 180px;
      max-width: 50%;
    }
    .nav-links {
      display: flex;
      gap: 30px;
    }
    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 1.5rem;
      cursor: pointer;
    }

    /* Mobile Navigation */
    .backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      display: none;
    }
    .backdrop.active {
      display: block;
    }
    .mobile-nav {
      position: fixed;
      top: 0;
      right: -100%;
      width: 80%;
      max-width: 300px;
      height: 100vh;
      background-color: var(--main-bg-color);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      padding: 60px 30px 30px;
      transition: right 0.3s ease;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
    }
    .mobile-nav.active {
      right: 0;
    }
    .mobile-nav a {
      color: var(--text-color);
      text-decoration: none;
      padding: 15px 0;
      font-size: 1.2rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .mobile-nav a:hover {
      color: var(--accent-color);
    }
    .close-menu {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 1.5rem;
      cursor: pointer;
    }

    /* Hero Section */
    .hero {
      padding: 60px 0;
      text-align: center;
    }
    h1 {
      font-family: var(--header-font);
      font-size: 5rem;
      margin-bottom: 20px;
      letter-spacing: 4px;
      text-shadow: 0 0 10px rgba(46,125,50,0.3);
    }
    .hero p {
      font-size: 1.5rem;
      max-width: 700px;
      margin: 0 auto 40px;
    }
    .cta-button {
      display: inline-block;
      background-color: var(--accent-color);
      color: #000;
      padding: 15px 30px;
      font-weight: bold;
      text-decoration: none;
      border-radius: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 0 15px rgba(46,125,50,0.7);
    }
    .cta-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 25px rgba(46,125,50,1);
    }

    /* Plugin Showcase Section */
    .plugin-showcase {
      padding: 60px 0;
      display: flex;
      align-items: center;
      gap: 50px;
    }
    .plugin-image {
      flex: 1;
      text-align: center;
    }
    .plugin-image img {
      max-width: 100%;
      height: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      border-radius: 10px;
    }
    .plugin-details {
      flex: 1;
    }
    h2 {
      font-family: var(--header-font);
      font-size: 2.5rem;
      margin-bottom: 20px;
    }

    /* Features Section */
    .features {
      padding: 60px 0;
      background-color: var(--secondary-bg);
    }
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      margin-top: 40px;
    }
    .feature-card {
      background-color: rgba(255,255,255,0.05);
      padding: 30px;
      border-radius: 10px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid rgba(46,125,50,0.1);
      position: relative;
      overflow: hidden;
    }
    .feature-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--accent-color), transparent);
      opacity: 0.7;
    }
    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    .feature-card h3 {
      font-size: 1.5rem;
      margin-bottom: 15px;
      color: var(--accent-color);
      text-shadow: 0 0 6px rgba(46,125,50,0.7);
      display: flex;
      align-items: center;
    }
    .feature-card h3::before {
      content: '';
      display: inline-block;
      width: 6px;
      height: 6px;
      background-color: var(--accent-color);
      border-radius: 50%;
      margin-right: 10px;
      box-shadow: 0 0 8px rgba(46,125,50,0.8);
    }

    /* Demo Section */
    .demo-section {
      padding: 60px 0;
    }
    .demo-container {
      background-color: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 10px;
      margin-top: 40px;
      border: 1px solid rgba(46,125,50,0.1);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
    }
    .demo-container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(46,125,50,0.05) 0%, transparent 100%);
      pointer-events: none;
    }
    .track-selector {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
      justify-content: center;
    }
    .track-button {
      padding: 10px 15px;
      background-color: rgba(255,255,255,0.1);
      border: none;
      border-radius: 5px;
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid transparent;
      font-size: 0.9rem;
    }
    .track-button:hover,
    .track-button.active {
      background-color: var(--accent-color);
      color: #000;
      box-shadow: 0 0 10px rgba(46,125,50,0.5);
    }
    .track-button.active {
      border: 1px solid rgba(255,255,255,0.2);
    }
    .plugin-waveform {
      height: 120px;
      background-color: rgba(0,0,0,0.3);
      margin: 20px 0;
      position: relative;
      overflow: hidden;
      border-radius: 5px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
    }
    .waveform-animation {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,
        rgba(46,125,50,0) 0%,
        rgba(46,125,50,0.3) 50%,
        rgba(46,125,50,0) 100%
      );
      background-size: 200% 100%;
      animation: waveformMove 2s infinite linear;
    }
    @keyframes waveformMove {
      0% {
        background-position: -100% 0;
      }
      100% {
        background-position: 100% 0;
      }
    }
    .demo-controls {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .play-button,
    .stop-button {
      width: 50px;
      height: 50px;
      background-color: var(--accent-color);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(46,125,50,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      font-weight: bold;
    }
    .play-button:hover,
    .stop-button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(46,125,50,0.6);
    }
    .play-button::after {
      content: '';
      display: block;
      width: 0;
      height: 0;
      border-top: 12px solid transparent;
      border-bottom: 12px solid transparent;
      border-left: 16px solid #000;
      margin-left: 4px;
    }
    .stop-button::after {
      content: '■';
      font-size: 1.2rem;
      margin-left: 0;
      color: #000;
    }
    .track-info-container {
      text-align: center;
      margin: 10px 0;
    }
    .volume-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }
    .volume-container label {
      font-size: 0.9rem;
      font-weight: 500;
    }
    .volume-container input[type="range"] {
      width: 120px;
    }

    /* Plugin UI container */
    .plugin-container {
      width: 100%;
      margin: 30px auto;
      overflow: hidden;
      position: relative;
    }
    #patchViewOuterContainer {
      width: 100%;
      position: relative;
      overflow: hidden;
    }
    #patchViewInnerContainer {
      width: 100%;
      transform-origin: top left;
      position: relative;
    }

    /* Download Section */
    .download-section {
      padding: 60px 0;
      text-align: center;
      background-color: var(--secondary-bg);
      position: relative;
      overflow: hidden;
    }
    .download-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, rgba(46,125,50,0.1) 0%, transparent 70%);
      pointer-events: none;
    }
    .pricing-box {
      max-width: 500px;
      margin: 40px auto;
      background-color: rgba(0,0,0,0.2);
      padding: 30px;
      border-radius: 10px;
      border: 1px solid rgba(46,125,50,0.2);
      box-shadow: 0 15px 40px rgba(0,0,0,0.4);
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .pricing-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    }
    .pricing-box::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(46,125,50,0.05) 0%, transparent 70%);
      pointer-events: none;
    }
    .pricing-title {
      font-family: var(--body-font);
      font-size: 1.8rem;
      margin-bottom: 20px;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-shadow: none;
    }
    .price-input {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
    }
    .price-input span {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent-color);
    }
    .price-input input {
      width: 120px;
      padding: 12px;
      border: 2px solid rgba(46,125,50,0.3);
      border-radius: 5px;
      font-size: 1.3rem;
      background-color: rgba(0,0,0,0.2);
      color: var(--text-color);
      text-align: center;
      transition: all 0.3s ease;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .price-input input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 10px rgba(46,125,50,0.5), inset 0 2px 5px rgba(0,0,0,0.2);
    }

    .newsletter {
      max-width: 500px;
      margin: 60px auto 0;
      text-align: center;
    }
    .newsletter h3 {
      margin-bottom: 20px;
      font-size: 1.6rem;
      font-family: var(--body-font);
      font-weight: 600;
      color: var(--accent-color);
      text-shadow: none;
    }
    .newsletter p {
      margin-bottom: 20px;
      font-size: 1rem;
    }
    .email-form {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .email-form input {
      flex: 1;
      padding: 12px;
      border: 2px solid rgba(46,125,50,0.2);
      border-radius: 5px;
      background-color: rgba(0,0,0,0.2);
      color: var(--text-color);
      transition: all 0.3s ease;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .email-form input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 10px rgba(46,125,50,0.5), inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .submit-button {
      padding: 12px 20px;
      background-color: var(--accent-color);
      color: #000;
      border: none;
      border-radius: 5px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 8px rgba(46,125,50,0.5);
      letter-spacing: 0.5px;
      white-space: nowrap;
    }
    .submit-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 15px rgba(46,125,50,0.8);
    }

    /* Footer */
    footer {
      padding: 40px 0;
      text-align: center;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    .social-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }
    .social-icon {
      width: 40px;
      height: 40px;
      background-color: rgba(255,255,255,0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-color);
      text-decoration: none;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }
    .social-icon:hover {
      background-color: var(--accent-color);
      color: #000;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(46,125,50,0.5);
    }

    /* RESPONSIVE MEDIA QUERIES */
    @media (max-width: 992px) {
      .plugin-details {
        text-align: center;
      }
      h1 {
        font-size: 3.5rem;
      }
      .hero p {
        font-size: 1.3rem;
      }
    }
    @media (max-width: 768px) {
      .nav-links {
        display: none;
      }
      .mobile-menu-toggle {
        display: block;
      }
      h1 {
        font-size: 3rem;
      }
      .hero p {
        font-size: 1.2rem;
      }
      .feature-card h3 {
        font-size: 1.3rem;
      }
      .features-grid {
        grid-template-columns: 1fr;
      }
      .email-form {
        flex-direction: column;
      }
      .submit-button {
        width: 100%;
      }
      .hero {
        padding: 40px 0;
      }
      .features, .demo-section, .download-section {
        padding: 40px 0;
      }
    }
    @media (max-width: 480px) {
      h1 {
        font-size: 2.5rem;
      }
      h2 {
        font-size: 2rem;
      }
      .pricing-title {
        font-size: 1.5rem;
      }
      .cta-button {
        padding: 12px 20px;
        font-size: 0.9rem;
      }
      .play-button, .stop-button {
        width: 45px;
        height: 45px;
      }
      .track-button {
        padding: 8px 10px;
        font-size: 0.8rem;
      }
      .container {
        padding: 0 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container">
      <nav>
        <img src="https://rawcdn.githack.com/gabefryaudio/Uppercomp/refs/heads/main/Secret%20Weapon%20DSP%20logo%20(straight).svg" alt="Secret Weapon DSP Logo" class="logo" />
        <div class="nav-links">
          <a href="#features">Features</a>
          <a href="#demo">Demo</a>
          <a href="#download">Download</a>
          <a href="#contact">Contact</a>
        </div>
        <button class="mobile-menu-toggle" aria-label="Open mobile menu">
          <i class="fas fa-bars"></i>
        </button>
      </nav>
    </div>
  </header>

  <!-- Backdrop for mobile nav -->
  <div class="backdrop"></div>
  <!-- Mobile Navigation -->
  <div class="mobile-nav">
    <button class="close-menu" aria-label="Close mobile menu">
      <i class="fas fa-times"></i>
    </button>
    <a href="#features">Features</a>
    <a href="#demo">Demo</a>
    <a href="#download">Download</a>
    <a href="#contact">Contact</a>
  </div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <h1>UPPERCOMP</h1>
      <p>A punchy, dense and vibrant compressor inspired by classic British hardware and modern VCA technology.</p>
      <a href="#download" class="cta-button">Download Now</a>
    </div>
  </section>

  <!-- Plugin Showcase Section -->
  <section class="plugin-showcase">
    <div class="container">
      <div class="plugin-image">
        <img src="https://rawcdn.githack.com/gabefryaudio/Uppercomp/cf6d735ba6d11ebf6f8924c502fb9363c68ad944/Uppercomp%20still%201.png" alt="Uppercomp Plugin Interface" />
      </div>
      <div class="plugin-details">
        <h2>MEET UPPERCOMP</h2>
        <p>
          UPPERCOMP delivers the punch and density of classic hardware compressors with modern flexibility.
          It combines the character of vintage British preamps with the precision of DBX gold can VCAs,
          creating a compressor that brings life and energy to any source.
        </p>
        <p>
          Whether you're looking to add punch to drums, glue to a mix, or character to vocals,
          UPPERCOMP delivers with an intuitive interface and a sound that stands out in the digital realm.
        </p>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="features" id="features">
    <div class="container">
      <h2>FEATURES</h2>
      <p>
        UPPERCOMP isn't just another digital compressor – it's a meticulously crafted tool that brings
        analog character to your digital workflow.
      </p>
      <div class="features-grid">
        <div class="feature-card">
          <h3>Vintage British Preamp</h3>
          <p>
            The front-end is modeled after classic British console preamps, adding subtle harmonic
            richness before compression even begins.
          </p>
        </div>
        <div class="feature-card">
          <h3>DBX Gold Can VCA</h3>
          <p>
            The compression circuit is inspired by the sought-after DBX gold can VCAs, delivering
            that familiar punch and control that made them legendary.
          </p>
        </div>
        <div class="feature-card">
          <h3>Diode-Based Envelope</h3>
          <p>
            A state space half-wave rectifier diode-based envelope follower creates colorful,
            characterful compression unlike flat digital algorithms.
          </p>
        </div>
        <div class="feature-card">
          <h3>Parallel Processing</h3>
          <p>
            Built-in saturation mix and compression mix controls let you dial in the perfect blend
            of clean and processed signal.
          </p>
        </div>
        <div class="feature-card">
          <h3>Advanced Controls</h3>
          <p>
            Lookahead functionality and sidechain filtering give you precise control over
            compression behavior and character.
          </p>
        </div>
        <div class="feature-card">
          <h3>Versatile Applications</h3>
          <p>
            While it excels on drums, UPPERCOMP enhances any source that benefits from punchy,
            character-rich compression.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Demo Section -->
  <section class="demo-section" id="demo">
    <div class="container">
      <h2>HEAR IT IN ACTION</h2>
      <p>
        Experience UPPERCOMP on different audio sources. Use the interactive plugin below to hear
        how it transforms your tracks.
      </p>
      <div class="demo-container">
        <!-- Track Selector: "Kick In" is first and default -->
        <div class="track-selector">
          <button class="track-button active">Kick In</button>
          <button class="track-button">Kick (Sub)</button>
          <button class="track-button">Snare</button>
          <button class="track-button">Tom</button>
          <button class="track-button">Overheads</button>
          <button class="track-button">Room</button>
        </div>
        <div class="plugin-waveform">
          <div class="waveform-animation"></div>
        </div>
        <div class="track-info-container">
          <p id="trackInfo">Kick In - "Choose a track"</p>
          <p>Toggle processing with button above</p>
        </div>
        <div class="demo-controls">
          <button class="play-button" title="Play / Resume Audio"></button>
          <button class="stop-button" title="Stop Audio"></button>
          <div class="volume-container">
            <label for="volumeSlider">Volume:</label>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
          </div>
        </div>
        <!-- Plugin UI Container -->
        <div class="plugin-container">
          <div id="patchViewOuterContainer">
            <div id="patchViewInnerContainer">
              <!-- The patch's GUI is inserted dynamically by the script -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Download Section -->
  <section class="download-section" id="download">
    <div class="container">
      <h2>GET UPPERCOMP</h2>
      <p>
        Download UPPERCOMP and experience the punch and character that will elevate your mixes.
      </p>
      <div class="pricing-box">
        <h3 class="pricing-title">Pay What You Think It's Worth</h3>
        <p>
          We believe in fair value exchange. If UPPERCOMP becomes a secret weapon in your arsenal,
          support future development at a price that feels right.
        </p>
        <div class="price-input">
          <span>$</span>
          <input type="number" value="25" min="0" />
        </div>
        <!-- Shopify Buy Button integration -->
        <div id="product-component-1740968930863"></div>
        <script type="text/javascript">
        /*<![CDATA[*/
        (function () {
          var scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';
          if (window.ShopifyBuy) {
            if (window.ShopifyBuy.UI) {
              ShopifyBuyInit();
            } else {
              loadScript();
            }
          } else {
            loadScript();
          }
          function loadScript() {
            var script = document.createElement('script');
            script.async = true;
            script.src = scriptURL;
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
            script.onload = ShopifyBuyInit;
          }
          function ShopifyBuyInit() {
            var client = ShopifyBuy.buildClient({
              domain: 'vckhed-ia.myshopify.com',
              storefrontAccessToken: 'df7325f00afa869a92034415d3428d8e',
            });
            ShopifyBuy.UI.onReady(client).then(function (ui) {
              ui.createComponent('product', {
                id: '7649057734795',
                node: document.getElementById('product-component-1740968930863'),
                moneyFormat: '%24%7B%7Bamount%7D%7D',
                options: {
                  "product": {
                    "styles": {
                      "product": {
                        "@media (min-width: 601px)": {
                          "max-width": "calc(25% - 20px)",
                          "margin-left": "20px",
                          "margin-bottom": "50px"
                        }
                      },
                      "button": {
                        ":hover": {
                          "background-color": "#29712d"
                        },
                        "background-color": "#2e7d32",
                        ":focus": {
                          "background-color": "#29712d"
                        }
                      }
                    },
                    "buttonDestination": "checkout",
                    "text": {
                      "button": "Buy now"
                    }
                  },
                  "productSet": {
                    "styles": {
                      "products": {
                        "@media (min-width: 601px)": {
                          "margin-left": "-20px"
                        }
                      }
                    }
                  },
                  "modalProduct": {
                    "contents": {
                      "img": false,
                      "imgWithCarousel": true,
                      "button": false,
                      "buttonWithQuantity": true
                    },
                    "styles": {
                      "product": {
                        "@media (min-width: 601px)": {
                          "max-width": "100%",
                          "margin-left": "0px",
                          "margin-bottom": "0px"
                        }
                      },
                      "button": {
                        ":hover": {
                          "background-color": "#29712d"
                        },
                        "background-color": "#2e7d32",
                        ":focus": {
                          "background-color": "#29712d"
                        }
                      }
                    },
                    "text": {
                      "button": "Add to cart"
                    }
                  },
                  "option": {},
                  "cart": {
                    "styles": {
                      "button": {
                        ":hover": {
                          "background-color": "#29712d"
                        },
                        "background-color": "#2e7d32",
                        ":focus": {
                          "background-color": "#29712d"
                        }
                      }
                    },
                    "text": {
                      "total": "Subtotal",
                      "button": "Checkout"
                    }
                  },
                  "toggle": {
                    "styles": {
                      "toggle": {
                        "background-color": "#2e7d32",
                        ":hover": {
                          "background-color": "#29712d"
                        },
                        ":focus": {
                          "background-color": "#29712d"
                        }
                      }
                    }
                  }
                },
              });
            });
          }
        })();
        /*]]>*/
        </script>
      </div>
      <div class="newsletter">
        <h3>Stay Updated</h3>
        <p>
          Sign up to receive updates about UPPERCOMP and future Secret Weapon DSP releases.
        </p>
        <form class="email-form">
          <input type="email" placeholder="Your email address" id="email" name="email" autocomplete="email" />
          <button type="submit" class="submit-button">Subscribe</button>
        </form>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer id="contact">
    <div class="container">
      <div class="social-links">
        <a href="#" class="social-icon" title="Facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="#" class="social-icon" title="Instagram">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="#" class="social-icon" title="YouTube">
          <i class="fab fa-youtube"></i>
        </a>
        <a href="#" class="social-icon" title="TikTok">
          <i class="fab fa-tiktok"></i>
        </a>
      </div>
      <p>© 2025 Secret Weapon DSP. All rights reserved.</p>
    </div>
  </footer>

  <!-- Single merged script: sets up the plugin, routes audio through it, and manages the mobile menu & scaling. -->
  <script type="module">
    import { createUppercompPatchConnection } from "./Uppercomp_WAM/cmaj_Uppercomp.js";
    import { createPatchView } from "./Uppercomp_WAM/cmaj_api/cmaj-patch-view.js";

    document.addEventListener("DOMContentLoaded", async () => {
      // Mobile menu toggle logic
      const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
      const mobileNav = document.querySelector('.mobile-nav');
      const closeMenuBtn = document.querySelector('.close-menu');
      const backdrop = document.querySelector('.backdrop');

      if (mobileMenuToggle && mobileNav && closeMenuBtn && backdrop) {
        mobileMenuToggle.addEventListener('click', () => {
          mobileNav.classList.add('active');
          backdrop.classList.add('active');
        });

        closeMenuBtn.addEventListener('click', () => {
          mobileNav.classList.remove('active');
          backdrop.classList.remove('active');
        });

        backdrop.addEventListener('click', () => {
          mobileNav.classList.remove('active');
          backdrop.classList.remove('active');
        });
      }

      // 1) Create an AudioContext for the plugin
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();

      // 2) Initialize the Uppercomp patch connection
      let connection;
      try {
        connection = await createUppercompPatchConnection(audioContext, "uppercomp-worklet");
      } catch (error) {
        console.error("Error during Uppercomp initialization:", error);
        return;
      }

      // 3) Find a connectable AudioNode from the connection
      let pluginNode = null;
      if (connection.node && typeof connection.node.connect === "function") {
        pluginNode = connection.node;
      } else if (connection.patchNode && typeof connection.patchNode.connect === "function") {
        pluginNode = connection.patchNode;
      } else if (connection.audioWorkletPatchNode && typeof connection.audioWorkletPatchNode.connect === "function") {
        pluginNode = connection.audioWorkletPatchNode;
      } else if (connection.audioNode && typeof connection.audioNode.connect === "function") {
        pluginNode = connection.audioNode;
      } else {
        console.error("No connectable AudioNode found in Uppercomp connection.");
        return;
      }

      // 4) Create a GainNode for volume control, connect plugin -> gain -> destination
      const gainNode = audioContext.createGain();
      gainNode.gain.value = 1;
      pluginNode.connect(gainNode);
      gainNode.connect(audioContext.destination);

      // 5) Track playback logic with fade out for manual stop.
      let currentSource = null;
      let currentGain = null; // per-track gain node for fadeout
      let currentTrackName = 'Kick In';

      // Accepts an optional parameter to determine if a fade-out should be applied.
      function stopCurrentTrack(fade = true) {
        if (currentSource && currentGain) {
          if (fade) {
            const fadeTime = 1.0; // fade-out time in seconds
            currentGain.gain.setValueAtTime(currentGain.gain.value, audioContext.currentTime);
            currentGain.gain.linearRampToValueAtTime(0, audioContext.currentTime + fadeTime);
            setTimeout(() => {
              currentSource.stop();
              currentSource.disconnect();
              currentGain.disconnect();
              currentSource = null;
              currentGain = null;
            }, fadeTime * 1000);
          } else {
            // Immediate stop (for track switching)
            currentSource.stop();
            currentSource.disconnect();
            currentGain.disconnect();
            currentSource = null;
            currentGain = null;
          }
        }
      }

      async function playSample(url, trackName) {
        // When switching tracks, stop any current source immediately.
        stopCurrentTrack(false);
        try {
          const response = await fetch(url);
          const arrayBuffer = await response.arrayBuffer();
          const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
          const source = audioContext.createBufferSource();
          source.buffer = audioBuffer;
          source.loop = true;
          
          // Create a per-track gain node for fade control
          const sampleGain = audioContext.createGain();
          sampleGain.gain.value = 1;
          
          // Connect sample source -> sampleGain -> plugin node
          source.connect(sampleGain);
          sampleGain.connect(pluginNode);
          
          currentSource = source;
          currentGain = sampleGain;
          currentTrackName = trackName;
          
          // Update track info UI
          const trackInfo = document.getElementById('trackInfo');
          if (trackInfo) {
            trackInfo.textContent = ${trackName} - "Now Playing";
          }
          source.start();
        } catch (error) {
          console.error('Error playing sample:', error);
        }
      }

      // 6) Handle track buttons
      const trackButtons = document.querySelectorAll('.track-button');
      trackButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          trackButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const text = btn.textContent.trim();
          let filePath = '';
          if (text === 'Kick (Sub)') filePath = './Audio_Files/Kick_(Sub).wav';
          else if (text === 'Kick In') filePath = './Audio_Files/Kick_In.wav';
          else if (text === 'Snare') filePath = './Audio_Files/Snare.wav';
          else if (text === 'Tom') filePath = './Audio_Files/Tom.wav';
          else if (text === 'Overheads') filePath = './Audio_Files/Overheads.wav';
          else if (text === 'Room') filePath = './Audio_Files/Room.wav';
          if (filePath) {
            playSample(filePath, text);
          }
        });
      });

      // 7) Play button: Default to "Kick In"
      const playBtn = document.querySelector('.play-button');
      if (playBtn) {
        playBtn.addEventListener('click', async () => {
          if (audioContext.state === 'suspended') {
            await audioContext.resume();
          }
          if (!currentSource) {
            playSample('./Audio_Files/Kick_In.wav', 'Kick In');
          }
        });
      }

      // 8) Stop button with fade out
      const stopBtn = document.querySelector('.stop-button');
      if (stopBtn) {
        stopBtn.addEventListener('click', () => {
          stopCurrentTrack(true);
          const trackInfo = document.getElementById('trackInfo');
          if (trackInfo) {
            trackInfo.textContent = ${currentTrackName} - "Stopped";
          }
        });
      }

      // 9) Volume slider
      const volumeSlider = document.getElementById('volumeSlider');
      if (volumeSlider) {
        volumeSlider.addEventListener('input', () => {
          gainNode.gain.value = volumeSlider.value;
        });
      }

      // 10) Create and insert the plugin UI, with scale logic
      const outerContainer = document.getElementById("patchViewOuterContainer");
      const innerContainer = document.getElementById("patchViewInnerContainer");

      try {
        const patchView = await createPatchView(connection);
        innerContainer.innerHTML = "";
        innerContainer.appendChild(patchView);
        scalePatchView();
        const observer = new MutationObserver(() => scalePatchView());
        observer.observe(innerContainer, { childList: true, subtree: true });
      } catch (guiError) {
        console.error("Error creating patch view:", guiError);
      }

      function scalePatchView() {
        if (!outerContainer || !innerContainer) return;
        
        const widthNative = 1200;
        const heightNative = 400;
        const outerWidth = outerContainer.clientWidth;
        const scaleFactor = outerWidth / widthNative;
      
        innerContainer.style.position = "absolute";
        innerContainer.style.left = "50%";
        innerContainer.style.transformOrigin = "top left";
        innerContainer.style.transform = translateX(-50%) scale(${scaleFactor});
      
        outerContainer.style.position = "relative";
        outerContainer.style.height = ${heightNative * scaleFactor}px;
      }

      // Re-scale on window resize
      let resizeTimeout;
      window.addEventListener("resize", () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(scalePatchView, 200);
      });

      // Re-enforce vertical scroll if changed
      document.body.style.setProperty("overflow", "auto", "important");
      document.documentElement.style.setProperty("overflow", "auto", "important");
      const bodyObserver = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
          if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
            document.body.style.setProperty("overflow", "auto", "important");
            document.documentElement.style.setProperty("overflow", "auto", "important");
          }
        });
      });
      bodyObserver.observe(document.body, { attributes: true, attributeFilter: ['style'] });
    });
  </script>
</body>
</html>
