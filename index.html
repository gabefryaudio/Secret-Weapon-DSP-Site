<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Updated meta viewport tag -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>Secret Weapon DSP - UPPERCOMP</title>
  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Audiowide&family=Inter:wght@400;500;600&display=swap"
    rel="stylesheet"
  />
  <!-- Font Awesome (CDN) -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <style>
    :root {
      --main-bg-color: #1a1a1a;
      --accent-color: #2E7D32;
      --text-color: #ccc;
      --secondary-bg: #1e1e1e;
      --header-font: 'Audiowide', sans-serif;
      --body-font: 'Inter', sans-serif;
    }

    /* Global resets */
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    /* Ensure proper scrolling on mobile */
    html, body {
      margin: 0;
      padding: 0;
      background-color: var(--main-bg-color);
      color: var(--text-color);
      font-family: var(--body-font);
      line-height: 1.6;
      width: 100%;
      height: 100%; /* Added height */
      overflow-x: hidden;
      overflow-y: visible; /* Allow vertical content flow */
      position: relative;
    }

    img {
      max-width: 100%;
      height: auto;
    }

    /* Ensure container doesn't restrict scrolling */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      overflow: visible;
    }

    /* Header styles */
    header {
      padding: 20px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      width: 100%;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .logo {
      width: 180px;
      max-width: 100%;
    }
    .nav-links {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .nav-links a {
      color: var(--text-color);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
      padding: 5px;
    }
    .nav-links a:hover {
      color: var(--accent-color);
    }

    /* Hero Section */
    .hero {
      padding: 60px 0;
      text-align: center;
      width: 100%;
    }
    h1 {
      font-family: var(--header-font);
      font-size: clamp(2.5rem, 8vw, 5rem);
      margin-bottom: 20px;
      letter-spacing: 4px;
      text-shadow: 0 0 10px rgba(46,125,50,0.3);
    }
    .hero p {
      font-size: clamp(1rem, 3vw, 1.5rem);
      max-width: 700px;
      margin: 0 auto 40px;
      padding: 0 20px;
    }
    .cta-button {
      display: inline-block;
      background-color: var(--accent-color);
      color: #000;
      padding: 15px 30px;
      font-weight: bold;
      text-decoration: none;
      border-radius: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 0 15px rgba(46,125,50,0.7);
    }
    .cta-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 25px rgba(46,125,50,1);
    }

    /* Plugin Showcase Section */
    .plugin-showcase {
      padding: 60px 0;
      width: 100%;
    }
    
    .plugin-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
    }
    
    .plugin-image {
      width: 100%;
      text-align: center;
    }
    .plugin-image img {
      max-width: 100%;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      border-radius: 10px;
    }
    .plugin-details {
      width: 100%;
    }
    h2 {
      font-family: var(--header-font);
      font-size: clamp(1.8rem, 5vw, 2.5rem);
      margin-bottom: 20px;
    }

    /* Features Section */
    .features {
      padding: 60px 0;
      background-color: var(--secondary-bg);
      width: 100%;
    }
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 40px;
    }
    .feature-card {
      background-color: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 10px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid rgba(46,125,50,0.1);
      position: relative;
      overflow: hidden;
    }
    .feature-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--accent-color), transparent);
      opacity: 0.7;
    }
    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    .feature-card h3 {
      font-size: 1.3rem;
      margin-bottom: 15px;
      color: var(--accent-color);
      text-shadow: 0 0 6px rgba(46,125,50,0.7);
      display: flex;
      align-items: center;
    }
    .feature-card h3::before {
      content: '';
      display: inline-block;
      width: 6px;
      height: 6px;
      background-color: var(--accent-color);
      border-radius: 50%;
      margin-right: 10px;
      box-shadow: 0 0 8px rgba(46,125,50,0.8);
    }

    /* Demo Section */
    section {
      width: 100%;
      overflow: visible;
      position: relative;
    }
    .demo-section {
      padding: 60px 0;
      width: 100%;
    }
    .demo-container {
      background-color: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 10px;
      margin-top: 40px;
      border: 1px solid rgba(46,125,50,0.1);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      position: relative;
      width: 100%;
    }
    .demo-container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(46,125,50,0.05) 0%, transparent 100%);
      pointer-events: none;
    }
    .track-selector {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .track-button {
      padding: 8px 15px;
      background-color: rgba(255,255,255,0.1);
      border: none;
      border-radius: 5px;
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid transparent;
      font-size: 0.9rem;
    }
    .track-button:hover,
    .track-button.active {
      background-color: var(--accent-color);
      color: #000;
      box-shadow: 0 0 10px rgba(46,125,50,0.5);
    }
    .track-button.active {
      border: 1px solid rgba(255,255,255,0.2);
    }
    .plugin-waveform {
      height: 120px;
      background-color: rgba(0,0,0,0.3);
      margin: 20px 0;
      position: relative;
      overflow: hidden;
      border-radius: 5px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
    }
    .waveform-animation {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,
        rgba(46,125,50,0) 0%,
        rgba(46,125,50,0.3) 50%,
        rgba(46,125,50,0) 100%
      );
      animation: waveformMove 2s infinite linear;
    }
    @keyframes waveformMove {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    .demo-controls {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    .play-button,
    .stop-button {
      width: 50px;
      height: 50px;
      background-color: var(--accent-color);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(46,125,50,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      font-weight: bold;
    }
    .play-button:hover,
    .stop-button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(46,125,50,0.6);
    }
    .play-button::after {
      content: '';
      display: block;
      width: 0;
      height: 0;
      border-top: 12px solid transparent;
      border-bottom: 12px solid transparent;
      border-left: 16px solid #000;
      margin-left: 3px;
    }
    .stop-button::after {
      content: '■';
      font-size: 1.3rem;
      margin-left: 0;
      color: #000;
    }
    .volume-container {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      max-width: 300px;
    }
    .volume-container label {
      font-size: 0.9rem;
      font-weight: 500;
    }
    .volume-container input[type="range"] {
      width: 100%;
    }

    /* Updated Plugin Scroll Container */
    .outerScrollWrapper {
      width: 100%;
      overflow-x: auto;
      overflow-y: visible;
      -webkit-overflow-scrolling: touch;
      margin: 30px 0;
      padding-bottom: 10px;
    }

    /* Responsive Plugin Container */
    #patchViewOuterContainer {
      width: 100%;
      min-width: 320px;
      max-width: 1200px;
      height: auto;
      min-height: 400px;
      overflow: auto;
    }
    
    #patchViewInnerContainer {
      width: 100%;
      height: 100%;
      min-height: 400px;
    }

    /* Download Section */
    .download-section {
      padding: 60px 0;
      text-align: center;
      background-color: var(--secondary-bg);
      position: relative;
      overflow: hidden;
      width: 100%;
    }
    .download-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, rgba(46,125,50,0.1) 0%, transparent 70%);
      pointer-events: none;
    }
    .pricing-box {
      max-width: 500px;
      margin: 40px auto;
      background-color: rgba(0,0,0,0.2);
      padding: 30px;
      border-radius: 10px;
      border: 1px solid rgba(46,125,50,0.2);
      box-shadow: 0 15px 40px rgba(0,0,0,0.4);
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .pricing-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    }
    .pricing-box::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(46,125,50,0.05) 0%, transparent 70%);
      pointer-events: none;
    }
    .pricing-title {
      font-family: var(--body-font);
      font-size: 1.8rem;
      margin-bottom: 20px;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-shadow: none;
    }
    .price-input {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
    }
    .price-input span {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent-color);
    }
    .price-input input {
      width: 150px;
      padding: 15px;
      border: 2px solid rgba(46,125,50,0.3);
      border-radius: 5px;
      font-size: 1.5rem;
      background-color: rgba(0,0,0,0.2);
      color: var(--text-color);
      text-align: center;
      transition: all 0.3s ease;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .price-input input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 10px rgba(46,125,50,0.5), inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .newsletter {
      max-width: 500px;
      margin: 60px auto 0;
      text-align: center;
    }
    .newsletter h3 {
      margin-bottom: 20px;
      font-size: 1.6rem;
      font-family: var(--body-font);
      font-weight: 600;
      color: var(--accent-color);
      text-shadow: none;
    }
    .newsletter p {
      margin-bottom: 20px;
      font-size: 1rem;
    }
    .email-form {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .email-form input {
      flex: 1;
      min-width: 200px;
      padding: 15px;
      border: 2px solid rgba(46,125,50,0.2);
      border-radius: 5px;
      background-color: rgba(0,0,0,0.2);
      color: var(--text-color);
      transition: all 0.3s ease;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .email-form input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 10px rgba(46,125,50,0.5), inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .submit-button {
      padding: 15px 20px;
      background-color: var(--accent-color);
      color: #000;
      border: none;
      border-radius: 5px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 8px rgba(46,125,50,0.5);
      letter-spacing: 0.5px;
    }
    .submit-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 15px rgba(46,125,50,0.8);
    }
    
    /* Footer */
    footer {
      padding: 30px 0;
      text-align: center;
    }
    .social-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    .social-icon {
      color: var(--text-color);
      font-size: 1.5rem;
      transition: color 0.3s ease;
    }
    .social-icon:hover {
      color: var(--accent-color);
    }
    
    /* Media Queries */
    @media (min-width: 768px) {
      .plugin-content {
        flex-direction: row;
        align-items: center;
      }
      
      .plugin-image, .plugin-details {
        width: 50%;
      }
      
      .demo-controls {
        align-items: center;
      }
      
      .volume-container {
        width: auto;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container">
      <nav>
        <img
          src="https://rawcdn.githack.com/gabefryaudio/Uppercomp/refs/heads/main/Secret%20Weapon%20DSP%20logo%20(straight).svg"
          alt="Secret Weapon DSP Logo"
          class="logo"
        />
        <div class="nav-links">
          <a href="#features">Features</a>
          <a href="#demo">Demo</a>
          <a href="#download">Download</a>
          <a href="#contact">Contact</a>
        </div>
      </nav>
    </div>
  </header>
  
  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <h1>UPPERCOMP</h1>
      <p>A punchy, dense and vibrant compressor inspired by classic British hardware and modern VCA technology.</p>
      <a href="#download" class="cta-button">Download Now</a>
    </div>
  </section>
  
  <!-- Plugin Showcase Section -->
  <section class="plugin-showcase">
    <div class="container">
      <div class="plugin-image">
        <img src="https://rawcdn.githack.com/gabefryaudio/Uppercomp/cf6d735ba6d11ebf6f8924c502fb9363c68ad944/Uppercomp%20still%201.png" alt="Uppercomp Plugin Interface" />
      </div>
      <div class="plugin-details">
        <h2>MEET UPPERCOMP</h2>
        <p>
          UPPERCOMP delivers the punch and density of classic hardware compressors with modern flexibility. 
          It combines the character of vintage British preamps with the precision of DBX gold can VCAs, 
          creating a compressor that brings life and energy to any source.
        </p>
        <p>
          Whether you're looking to add punch to drums, glue to a mix, or character to vocals, 
          UPPERCOMP delivers with an intuitive interface and a sound that stands out in the digital realm.
        </p>
      </div>
    </div>
  </section>
  
  <!-- Features Section -->
  <section class="features" id="features">
    <div class="container">
      <h2>FEATURES</h2>
      <p>
        UPPERCOMP isn't just another digital compressor – it's a meticulously crafted tool that brings 
        analog character to your digital workflow.
      </p>
      <div class="features-grid">
        <div class="feature-card">
          <h3>Vintage British Preamp</h3>
          <p>
            The front-end is modeled after classic British console preamps, adding subtle harmonic 
            richness before compression even begins.
          </p>
        </div>
        <div class="feature-card">
          <h3>DBX Gold Can VCA</h3>
          <p>
            The compression circuit is inspired by the sought-after DBX gold can VCAs, delivering 
            that familiar punch and control that made them legendary.
          </p>
        </div>
        <div class="feature-card">
          <h3>Diode-Based Envelope</h3>
          <p>
            A state space half-wave rectifier diode-based envelope follower creates colorful, 
            characterful compression unlike flat digital algorithms.
          </p>
        </div>
        <div class="feature-card">
          <h3>Parallel Processing</h3>
          <p>
            Built-in saturation mix and compression mix controls let you dial in the perfect blend 
            of clean and processed signal.
          </p>
        </div>
        <div class="feature-card">
          <h3>Advanced Controls</h3>
          <p>
            Lookahead functionality and sidechain filtering give you precise control over 
            compression behavior and character.
          </p>
        </div>
        <div class="feature-card">
          <h3>Versatile Applications</h3>
          <p>
            While it excels on drums, UPPERCOMP enhances any source that benefits from punchy, 
            character-rich compression.
          </p>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Demo Section -->
  <section class="demo-section" id="demo">
    <div class="container">
      <h2>HEAR IT IN ACTION</h2>
      <p>
        Experience UPPERCOMP on different audio sources. Use the interactive plugin below to hear 
        how it transforms your tracks.
      </p>
      <div class="demo-container">
        <div class="track-selector">
          <button class="track-button active">Kick (Sub)</button>
          <button class="track-button">Kick In</button>
          <button class="track-button">Snare</button>
          <button class="track-button">Tom</button>
          <button class="track-button">Overheads</button>
          <button class="track-button">Room</button>
        </div>
        <div class="plugin-waveform">
          <div class="waveform-animation"></div>
        </div>
        <div class="demo-controls">
          <button class="play-button" title="Play / Resume Audio"></button>
          <button class="stop-button" title="Stop Audio"></button>
          <div>
            <p id="trackInfo">Kick (Sub) - "Choose a track"</p>
            <p>Toggle processing with button above</p>
          </div>
          <div class="volume-container">
            <label for="volumeSlider">Volume:</label>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
          </div>
        </div>
        <!-- Outer scroll wrapper for the plugin -->
        <div class="outerScrollWrapper">
          <div id="patchViewOuterContainer">
            <div id="patchViewInnerContainer">
              <!-- The patch's GUI is inserted dynamically by the script -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Download Section -->
  <section class="download-section" id="download">
    <div class="container">
      <h2>GET UPPERCOMP</h2>
      <p>
        Download UPPERCOMP and experience the punch and character that will elevate your mixes.
      </p>
      <div class="pricing-box">
        <h3 class="pricing-title">Pay What You Think It's Worth</h3>
        <p>
          We believe in fair value exchange. If UPPERCOMP becomes a secret weapon in your arsenal, 
          support future development at a price that feels right.
        </p>
        <div class="price-input">
          <span>$</span>
          <input type="number" value="25" min="0" />
        </div>
        <a href="#" class="cta-button">Download Now</a>
      </div>
      <div class="newsletter">
        <h3>Stay Updated</h3>
        <p>
          Sign up to receive updates about UPPERCOMP and future Secret Weapon DSP releases.
        </p>
        <form class="email-form">
          <input type="email" placeholder="Your email address" />
          <button type="submit" class="submit-button">Subscribe</button>
        </form>
      </div>
    </div>
  </section>
  
  <!-- Footer -->
  <footer id="contact">
    <div class="container">
      <div class="social-links">
        <a href="#" class="social-icon" title="Facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="#" class="social-icon" title="Instagram">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="#" class="social-icon" title="YouTube">
          <i class="fab fa-youtube"></i>
        </a>
        <a href="#" class="social-icon" title="TikTok">
          <i class="fab fa-tiktok"></i>
        </a>
      </div>
      <p>© 2025 Secret Weapon DSP. All rights reserved.</p>
    </div>
  </footer>
  
  <!-- Script: Setup Uppercomp and audio routing -->
  <script type="module">
    import { createUppercompPatchConnection } from "./Uppercomp_WAM/cmaj_Uppercomp.js";
    import { createPatchView } from "./Uppercomp_WAM/cmaj_api/cmaj-patch-view.js";
    document.addEventListener("DOMContentLoaded", async () => {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      let connection;
      try {
        connection = await createUppercompPatchConnection(audioContext, "uppercomp-worklet");
      } catch (error) {
        console.error("Error during Uppercomp initialization:", error);
        return;
      }
      let pluginNode = null;
      if (connection.node && typeof connection.node.connect === "function") {
        pluginNode = connection.node;
      } else if (connection.patchNode && typeof connection.patchNode.connect === "function") {
        pluginNode = connection.patchNode;
      } else if (connection.audioWorkletPatchNode && typeof connection.audioWorkletPatchNode.connect === "function") {
        pluginNode = connection.audioWorkletPatchNode;
      } else if (connection.audioNode && typeof connection.audioNode.connect === "function") {
        pluginNode = connection.audioNode;
      } else {
        console.error("No connectable AudioNode found in Uppercomp connection.");
        return;
      }
      const gainNode = audioContext.createGain();
      gainNode.gain.value = 1;
      pluginNode.connect(gainNode);
      gainNode.connect(audioContext.destination);
      let currentSource = null;
      let currentTrackName = 'Kick (Sub)';
      let isPlaying = false;
      let audioBufferCache = {};
      let currentGainNode = null;
      const CROSSFADE_TIME = 0.2;
      async function loadSample(url) {
        if (audioBufferCache[url]) {
          return audioBufferCache[url];
        }
        try {
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`Failed to fetch ${url}: ${response.status} ${response.statusText}`);
          }
          const arrayBuffer = await response.arrayBuffer();
          const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
          audioBufferCache[url] = audioBuffer;
          return audioBuffer;
        } catch (error) {
          console.error(`Error loading audio file ${url}:`, error);
          throw error;
        }
      }
      function stopCurrentTrack(immediate = false) {
        if (currentSource) {
          if (immediate) {
            try {
              currentSource.stop();
              if (currentGainNode) currentGainNode.disconnect();
            } catch (e) {}
            currentSource = null;
            currentGainNode = null;
            isPlaying = false;
          } else {
            const now = audioContext.currentTime;
            if (currentGainNode) {
              currentGainNode.gain.setValueAtTime(currentGainNode.gain.value, now);
              currentGainNode.gain.linearRampToValueAtTime(0, now + CROSSFADE_TIME);
              const sourceToStop = currentSource;
              const gainToDisconnect = currentGainNode;
              setTimeout(() => {
                try { sourceToStop.stop(); } catch (e) {}
                gainToDisconnect.disconnect();
              }, CROSSFADE_TIME * 1000 + 50);
            } else {
              try { currentSource.stop(); } catch (e) {}
            }
          }
        }
      }
      async function playSample(url, trackName, crossfade = true) {
        try {
          if (audioContext.state === 'suspended') {
            await audioContext.resume();
          }
          const audioBuffer = await loadSample(url);
          const now = audioContext.currentTime;
          const newGainNode = audioContext.createGain();
          if (crossfade && isPlaying) {
            newGainNode.gain.setValueAtTime(0, now);
            newGainNode.gain.linearRampToValueAtTime(1, now + CROSSFADE_TIME);
            if (currentSource && currentGainNode) {
              currentGainNode.gain.setValueAtTime(currentGainNode.gain.value, now);
              currentGainNode.gain.linearRampToValueAtTime(0, now + CROSSFADE_TIME);
              const oldSource = currentSource;
              const oldGain = currentGainNode;
              setTimeout(() => {
                try { oldSource.stop(); } catch (e) {}
                oldGain.disconnect();
              }, CROSSFADE_TIME * 1000 + 50);
            } else {
              stopCurrentTrack(true);
            }
          } else {
            stopCurrentTrack(true);
            newGainNode.gain.setValueAtTime(1, now);
          }
          const source = audioContext.createBufferSource();
          source.buffer = audioBuffer;
          source.loop = true;
          source.connect(newGainNode);
          newGainNode.connect(pluginNode);
          source.start();
          currentSource = source;
          currentGainNode = newGainNode;
          currentTrackName = trackName;
          isPlaying = true;
          updateTrackInfo(trackName, "Now Playing");
          updatePlayButtonState(true);
          return true;
        } catch (error) {
          console.error('Error playing sample:', error);
          updateTrackInfo(trackName, "Error Loading");
          return false;
        }
      }
      function updateTrackInfo(trackName, status) {
        const trackInfo = document.getElementById('trackInfo');
        if (trackInfo) {
          trackInfo.textContent = `${trackName} - "${status}"`;
        }
      }
      function updatePlayButtonState(playing) {
        const playBtn = document.querySelector('.play-button');
        const stopBtn = document.querySelector('.stop-button');
        if (playBtn && stopBtn) {
          if (playing) {
            playBtn.classList.add('active');
            stopBtn.classList.remove('active');
          } else {
            playBtn.classList.remove('active');
            stopBtn.classList.add('active');
          }
        }
      }
      const trackFilePaths = {
        'Kick (Sub)': './Audio_Files/Kick_(Sub).wav',
        'Kick In': './Audio_Files/Kick_In.wav',
        'Snare': './Audio_Files/Snare.wav',
        'Tom': './Audio_Files/Tom.wav',
        'Overheads': './Audio_Files/Overheads.wav',
        'Room': './Audio_Files/Room.wav'
      };
      const trackButtons = document.querySelectorAll('.track-button');
      trackButtons.forEach((btn) => {
        btn.addEventListener('click', async () => {
          trackButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const trackName = btn.textContent.trim();
          const filePath = trackFilePaths[trackName];
          if (!filePath) {
            console.error(`No file path found for track: ${trackName}`);
            updateTrackInfo(trackName, "File Not Found");
            return;
          }
          updateTrackInfo(trackName, "Loading...");
          const success = await playSample(filePath, trackName, true);
          if (!success && currentTrackName && trackFilePaths[currentTrackName]) {
            console.log(`Falling back to previous track: ${currentTrackName}`);
            await playSample(trackFilePaths[currentTrackName], currentTrackName, false);
          }
        });
      });
      const playBtn = document.querySelector('.play-button');
      if (playBtn) {
        playBtn.addEventListener('click', async () => {
          if (isPlaying) return;
          if (currentTrackName && trackFilePaths[currentTrackName]) {
            await playSample(trackFilePaths[currentTrackName], currentTrackName, false);
          } else {
            const defaultTrack = 'Kick (Sub)';
            await playSample(trackFilePaths[defaultTrack], defaultTrack, false);
            trackButtons.forEach(btn => {
              if (btn.textContent.trim() === defaultTrack) {
                btn.classList.add('active');
              } else {
                btn.classList.remove('active');
              }
            });
          }
        });
      }
      const stopBtn = document.querySelector('.stop-button');
      if (stopBtn) {
        stopBtn.addEventListener('click', () => {
          stopCurrentTrack(true);
          updateTrackInfo(currentTrackName, "Stopped");
          updatePlayButtonState(false);
        });
      }
      const volumeSlider = document.getElementById('volumeSlider');
      if (volumeSlider) {
        volumeSlider.addEventListener('input', () => {
          gainNode.gain.value = volumeSlider.value;
        });
      }
      const outerContainer = document.getElementById("patchViewOuterContainer");
      const innerContainer = document.getElementById("patchViewInnerContainer");
      try {
        const patchView = await createPatchView(connection);
        innerContainer.innerHTML = "";
        innerContainer.appendChild(patchView);
      } catch (guiError) {
        console.error("Error creating patch view:", guiError);
      }
    });
  </script>
</body>
</html>
